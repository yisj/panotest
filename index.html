<style>
body{
  margin: 0;
  padding: 0;
  overflow: hidden;
}

p {
	margin: 0;
	padding: 0;
}

.container{
	display: flex;
	flex-direction: row;
}

#mapTitle{
	text-align: center;
	background: #dfe6e9;
	height: 20px;
	width: 100%;
}

#map {
  height: 45%;
  width: 100%;
}
#planTitle{
	text-align: center;
	background: #dfe6e9;
	height: 20px;
	width: 100%;
}

#plan {
	height:  45%;
	width: 100%;
	background: pink;
}

#rightViewerTitle{
	text-align: center;
	background: #b2bec3;
	height: 20px;
	width: 100%;
}

#rightViewerTail{
	background: #dfe6e9;
	height: 20px;
	width: 100%;
}


</style>

<body>
	<div class="container">
		<div id="leftColumn">
			<div id="mapTitle">
				<p><b>시공 진행 중 현장</b></p>
			</div>
			<div id="map">
			</div>
			<div id="planTitle">
				<b>현장상세뷰(항공뷰/도면)</b>
			</div>
			<div id="plan">
			</div>
		</div>
		<div id="rightColumn">
			<div id="rightViewerTitle">
				<p><b id="rightViewerTitleName">360 뷰어</b></p>
			</div>
			<div id="rightViewer"></div>
			<div id="rightViewerTail"></div>
		</div>
	</div>
</body>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="three.min.js"></script>
<script src="panolens.js"></script>
<script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBmCvIcaSd3ny5fwgz8HXWXRDDFGgPzBP8&callback=initMap&libraries=&v=weekly"
      async
    ></script>
<script>
	const panorama = new PANOLENS.ImagePanorama( 'r5376.JPG' );
	const viewerContainer = document.getElementById('rightViewer');
  var viewTitle = document.getElementById('rightViewerTitleName');
	
	viewerContainer.style.width=document.body.clientWidth * 0.7+"";
	viewerContainer.style.height=document.body.clientHeight*0.9 +"";
	const leftColumn = document.getElementById('leftColumn');
	leftColumn.style.width = document.body.clientWidth*0.3+"";
	leftColumn.style.height = document.body.clientHeight;

	const viewer = new PANOLENS.Viewer({container: viewerContainer});
	viewer.add( panorama );

	let map;

	function initMap() {
	const mapOptions = {
    zoom: 8,
    center: { lat: 36.67473947734108, lng: 128.04503713725038 },
  };
  map = new google.maps.Map(document.getElementById("map"), mapOptions);
  const marker = new google.maps.Marker({
    // The below line is equivalent to writing:
    // position: new google.maps.LatLng(-34.397, 150.644)
    //, 
    position: { lat: 35.81602417773923, lng: 126.48041358005399 },
    map: map,
  });
  // You can use a LatLng literal in place of a google.maps.LatLng object when
  // creating the Marker object. Once the Marker object is instantiated, its
  // position will be available as a google.maps.LatLng object. In this case,
  // we retrieve the marker's position using the
  // google.maps.LatLng.getPosition() method.
  const infowindow = new google.maps.InfoWindow({
    content: '<image src="site1.PNG" width="120" height="60"/>',
  });
  infowindow.open(map, marker);

  const marker2 = new google.maps.Marker({
    // The below line is equivalent to writing:
    // position: new google.maps.LatLng(-34.397, 150.644)
    //, 
    position: { lat: 36.65909640731252, lng: 126.67660325059965 },
    map: map,
  });
  // You can use a LatLng literal in place of a google.maps.LatLng object when
  // creating the Marker object. Once the Marker object is instantiated, its
  // position will be available as a google.maps.LatLng object. In this case,
  // we retrieve the marker's position using the
  // google.maps.LatLng.getPosition() method.
  const infowindow2 = new google.maps.InfoWindow({
    content: '<image src="site2.PNG" width="120" height="60"/>',
  });
  infowindow2.open(map, marker2);

  const marker3 = new google.maps.Marker({
    // The below line is equivalent to writing:
    // position: new google.maps.LatLng(-34.397, 150.644)
    //, 
    position: { lat: 35.837189963710806, lng: 128.5741703623363 },
    map: map,
  });
  // You can use a LatLng literal in place of a google.maps.LatLng object when
  // creating the Marker object. Once the Marker object is instantiated, its
  // position will be available as a google.maps.LatLng object. In this case,
  // we retrieve the marker's position using the
  // google.maps.LatLng.getPosition() method.
  const infowindow3 = new google.maps.InfoWindow({
    content: '<image src="site3.PNG" width="120" height="60"/>',
  });
  infowindow3.open(map, marker3);

  google.maps.event.addListener(marker2, "click", () => {
    let p2 = new PANOLENS.ImagePanorama( 'r2.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="충남혁신도시 아파트 현장 / 충청남도 홍성군 홍북읍 신경리 541-1";
    map1.style('display', 'none')
    map2.style('display', '')
    map3.style('display', 'none')
  });
  google.maps.event.addListener(marker3, "click", () => {
    let p2  = new PANOLENS.ImagePanorama( 'r5376.JPG' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="대구 주상복합 현장 / 대구광역시 달서구 장기동 555-10";
    map1.style('display', 'none')
    map2.style('display', 'none')
    map3.style('display', '')
    a0.style('display', '')
    a1.style('display', '')
    a2.style('display', '')
    b0.style('display', '')
    b1.style('display', '')
    b2.style('display', '')
    c0.style('display', '')
    c1.style('display', '')
    c2.style('display', '')

  });
  google.maps.event.addListener(marker, "click", () => {
    let p2  = new PANOLENS.ImagePanorama( 'r3.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="새만금 국제공항 현장 / 전라북도 김제시 진봉면 심포리 24151";
    map1.style('display', '')
    map2.style('display', 'none')
    map3.style('display', 'none')
  });
}

const plan = document.getElementById("plan");
let width = plan.clientWidth;
let height = plan.clientHeight;
let translate0 = [-100, -100];
let scale0 = 1;
let imgWidth = 1024;
let imgHeight = 685;


svg = d3.select("#plan").append("svg")
    .attr("width",  width + "px")
    .attr("height", height + "px");


svg.append("rect")
    .attr("class", "overlay")
    .attr("width", width + "px")
    .attr("height", height + "px")
    .attr("fill","aliceblue")



var svg_g = svg.append("g");
svg_g.attr("transform", "translate(" + translate0 + ")scale(" + scale0 + ")")
    .call(d3.behavior.zoom().scaleExtent([0.3, 8]).on("zoom", zoom));



var map_g = svg_g.append("g");
var marker_g = svg_g.append("g");

var map1 = map_g.append("image")
    .attr("width",  imgWidth + "px")
    .attr("height", imgHeight + "px")
    .attr("xlink:href", "construction-site1.jpg")
    .style('display', 'none');

var map2 = map_g.append("image")
    .attr("width",  imgWidth + "px")
    .attr("height", imgHeight + "px")
    .attr("xlink:href", "construction-site2.jpg")
    .style('display', 'none');

var map3 = map_g.append("image")
    .attr("width",  imgWidth + "px")
    .attr("height", imgHeight + "px")
    .attr("xlink:href", "construction-site3.jpg")
    .style('display', 'none');




var a0=map_g.append("svg:image")
  .attr('xlink:href', 'marker.png')
  .attr('width', 60)
  .attr('height', 80)
  .attr('x', 500)
  .attr('y', 500)
  .on('click', function(){
    let p2  = new PANOLENS.ImagePanorama( 'r4.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="대구 주상복합 현장 / A동 / 지하 2층 / B205";
  })
  .style('display', 'none');


var a1= map_g.append('rect')
  .attr('width', 130)
  .attr('height', 70)
  .attr('x', 465)
  .attr('y', 425)
  .attr('fill', 'white')
  .style('display', 'none');

var a2= map_g.append("svg:image")
  .attr('xlink:href', 'site4.PNG')
  .attr('width', 120)
  .attr('height', 60)
  .attr('x', 470)
  .attr('y', 430)
  .on('click', function(){
    let p2  = new PANOLENS.ImagePanorama( 'r4.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="대구 주상복합 현장 / A동 / 지하 2층 / B205";
  })
  .style('display', 'none');


var b0= map_g.append("svg:image")
  .attr('xlink:href', 'marker.png')
  .attr('width', 60)
  .attr('height', 80)
  .attr('x', 110)
  .attr('y', 320)
    .on('click', function(){
    let p2  = new PANOLENS.ImagePanorama( 'r8.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="대구 주상복합 현장 / A동 / 지상 7층 / 702";
  })
    .style('display', 'none');

var b1= map_g.append('rect')
  .attr('width', 130)
  .attr('height', 70)
  .attr('x', 75)
  .attr('y', 245)
  .attr('fill', 'white')
  .style('display', 'none');
  
var b2= map_g.append("svg:image")
  .attr('xlink:href', 'site5.PNG')
  .attr('width', 120)
  .attr('height', 60)
  .attr('x', 80)
  .attr('y', 250)
  .on('click', function(){
    let p2  = new PANOLENS.ImagePanorama( 'r8.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="대구 주상복합 현장 / A동 / 지상 7층 / 702";
  })
  .style('display', 'none');



var c0= map_g.append("svg:image")
  .attr('xlink:href', 'marker.png')
  .attr('width', 60)
  .attr('height', 80)
  .attr('x', 300)
  .attr('y', 100)
    .on('click', function(){
    let p2  = new PANOLENS.ImagePanorama( 'r6.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="대구 주상복합 현장 / A동 / 지상 1층 / 115";

  })
    .style('display', 'none');

var c1= map_g.append('rect')
  .attr('width', 130)
  .attr('height', 70)
  .attr('x', 265)
  .attr('y', 25)
  .attr('fill', 'white')
  .style('display', 'none');
  
var c2=map_g.append("svg:image")
  .attr('xlink:href', 'site6.PNG')
  .attr('width', 120)
  .attr('height', 60)
  .attr('x', 270)
  .attr('y', 30)
  .on('click', function(){
    let p2  = new PANOLENS.ImagePanorama( 'r6.jpg' );
    viewer.add( p2 );
    viewer.setPanorama( p2 );
    viewTitle.textContent="대구 주상복합 현장 / A동 / 지상 1층 / 115";
  })
  .style('display', 'none');



function zoom() {
  map_g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
  marker_g.attr("transform", "translate(" + d3.event.translate + ")");
  console.log("translate: " + d3.event.translate + ", scale: " + d3.event.scale);
}

function markerZoom() {
  marker_g.attr("transform", "translate(" + d3.event.translate + ")");
  console.log("translate: " + d3.event.translate + ", scale: " + d3.event.scale);
}


</script>